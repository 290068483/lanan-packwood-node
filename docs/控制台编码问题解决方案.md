# 控制台编码问题解决方案

## 问题描述

在Windows平台上，当程序在控制台中输出包含中文的内容时，可能会出现乱码问题。这是由于Windows默认的控制台编码（通常是GBK或GB2312）与程序中使用的UTF-8编码不匹配导致的。

## 解决方案

### 1. 技术实现

我们在程序的多个入口点添加了编码设置代码：

```javascript
const { exec } = require('child_process');
const os = require('os');

// 设置控制台编码为UTF-8，解决乱码问题
if (os.platform() === 'win32') {
  exec('chcp 65001', (error, stdout, stderr) => {
    if (error) {
      console.error('设置控制台编码时出错:', error);
    }
  });
}
```

其中 `chcp 65001` 命令将控制台代码页设置为UTF-8（65001是UTF-8的代码页编号）。

### 2. 应用范围

我们已经在以下文件中应用了编码设置：

- [electron-main.js](file:///c:/Users/Administrator/Desktop/pack-node-1.0/src/ui/electron-main.js) - Electron主进程
- [main-service.js](file:///c:/Users/Administrator/Desktop/pack-node-1.0/src/services/main-service.js) - 主服务进程
- [main-archive.js](file:///c:/Users/Administrator/Desktop/pack-node-1.0/src/main-archive.js) - 归档处理进程
- [cli-interface.js](file:///c:/Users/Administrator/Desktop/pack-node-1.0/src/ui/cli-interface.js) - 命令行界面
- [main.js](file:///c:/Users/Administrator/Desktop/pack-node-1.0/src/main.js) - 主入口文件

### 3. 编码工具模块

我们创建了一个专门的编码处理工具模块 [encoding-utils.js](file:///c:/Users/Administrator/Desktop/pack-node-1.0/src/utils/encoding-utils.js)，包含以下功能：

- `setConsoleEncoding()` - 设置控制台编码为UTF-8
- `ensureEncoding(str)` - 确保字符串使用正确的编码

## 注意事项

1. 该解决方案主要针对Windows平台，因为在Linux和macOS上默认使用UTF-8编码，通常不会出现乱码问题。

2. 如果系统中没有安装相应的代码页支持，`chcp 65001` 命令可能会失败。在这种情况下，控制台可能仍然显示乱码。

3. 在某些特殊情况下，如果控制台字体不支持中文显示，也可能出现乱码或方块字符。

## 验证方法

运行程序后，检查控制台输出是否正常显示中文内容：

```
正常显示：处理客户数据...
乱码示例：澶勭悊瀹㈡埛鏁版嵁...
```

如果仍然出现乱码，请尝试以下方法：

1. 更换控制台字体为支持中文的字体（如新宋体、微软雅黑等）
2. 检查系统区域设置是否正确
3. 确认系统已安装UTF-8编码支持

## 扩展方案

如果上述方案无法解决乱码问题，还可以考虑以下替代方案：

1. 使用 [iconv-lite](file:///c:/Users/Administrator/Desktop/pack-node-1.0/node_modules/body-parser/node_modules/iconv-lite/lib/index.js) 等库进行编码转换
2. 在输出前对字符串进行编码处理
3. 使用专门的日志库来处理输出格式