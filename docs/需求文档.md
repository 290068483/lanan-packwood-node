# Pack Node 系统需求文档

## 1. 文档概述

### 1.1 文档目的

本文档详细描述了 Pack Node 系统的功能需求、技术需求和业务流程，为系统开发、测试和维护提供明确的指导。

### 1.2 文档范围

本文档涵盖以下内容：

- 系统总体架构
- 功能模块需求
- 技术实现要求
- 业务流程规范
- 用户界面需求
- 数据管理需求

### 1.3 目标读者

- 系统开发人员
- 测试人员
- 项目管理人员
- 业务分析师
- 系统维护人员

## 2. 系统概述

### 2.1 系统简介

Pack Node 是一个基于 Node.js 和 Electron 的客户数据管理和打包处理系统。系统主要用于管理客户数据、跟踪打包状态、处理出货流程和补件管理。

### 2.2 系统目标

- 实现客户数据的自动化管理
- 提供打包状态的实时监控
- 支持出货流程的完整管理
- 实现补件处理的自动化
- 提供友好的用户界面

### 2.3 系统架构

#### 2.3.1 技术架构

- **前端框架**: Electron + HTML/CSS/JavaScript
- **后端框架**: Node.js + Express
- **数据库**: SQLite
- **文件处理**: 文件系统监控 + XML 解析
- **进程通信**: IPC (Inter-Process Communication)

#### 2.3.2 模块架构

```
Pack Node System
├── 用户界面层 (UI Layer)
│   ├── 主界面 (Main Window)
│   ├── 客户列表 (Customer List)
│   ├── 状态管理 (Status Management)
│   └── 操作界面 (Operation Interface)
├── 业务逻辑层 (Business Logic Layer)
│   ├── 客户状态管理器 (Customer Status Manager)
│   ├── 出货管理器 (Shipping Manager)
│   ├── 补件管理器 (Replacement Manager)
│   └── 数据管理器 (Data Manager)
├── 数据访问层 (Data Access Layer)
│   ├── 客户数据访问 (Customer Data Access)
│   ├── 状态历史访问 (Status History Access)
│   └── 配置数据访问 (Configuration Data Access)
└── 基础设施层 (Infrastructure Layer)
    ├── 文件系统监控 (File System Monitor)
    ├── 数据库连接 (Database Connection)
    ├── IPC 通信 (IPC Communication)
    └── 日志系统 (Logging System)
```

## 3. 功能需求

### 3.1 客户数据管理

#### 3.1.1 客户信息管理

**需求描述**: 系统需要能够管理从源文件读取的客户基本信息，包括客户名称、联系方式、地址等。客户信息主要通过解析源文件自动获取，而非手动添加。

**功能要求**:

- 支持从源文件自动读取客户信息
- 支持客户信息的查询和筛选
- 支持客户信息的批量导入
- 支持客户信息的导出功能
- 支持客户信息的实时更新（基于源文件变化）

**数据来源**:

- 客户信息主要从 XML 源文件中解析获取
- 系统监控源文件目录，自动检测新增或更新的客户文件
- 通过解析 XML 文件中的客户节点提取客户基本信息
- 客户信息与源文件保持同步，源文件变更时自动更新

**数据字段**:

```json
{
  "id": "客户唯一标识符",
  "name": "客户名称",
  "contact": "联系人",
  "phone": "联系电话",
  "address": "客户地址",
  "status": "客户状态",
  "sourceFile": "源文件路径",
  "lastSyncTime": "最后同步时间",
  "createTime": "创建时间",
  "updateTime": "更新时间"
}
```

#### 3.1.2 客户状态管理

**需求描述**: 系统需要能够跟踪和管理客户的各种状态，包括打包状态、出货状态、归档状态等。

**状态定义**:

- **打包状态**: unpacked（未打包）、packing（正在处理）、packed（已打包）、archived（已归档）
- **出货状态**: unshipped（未出货）、partial（部分出货）、shipped（全部出货）
- **补件状态**: none（无补件）、partial（部分补件）、full（全部补件）

**功能要求**:

- 自动监控 packages.json 文件变化
- 根据打包进度自动更新状态
- 支持手动状态更新
- 记录状态变更历史
- 提供状态查询接口

### 3.2 打包状态管理

#### 3.2.1 自动状态更新

**需求描述**: 系统需要能够自动监控 packages.json 文件的变化，并根据打包进度自动更新客户状态。

**功能要求**:

- 实时监控 packages.json 文件
- 解析文件中的 partIDs 记录
- 计算打包进度百分比
- 根据进度自动更新状态
- 记录状态变更历史

**状态计算规则**:

- packProgress = 0% → unpacked
- 0% < packProgress < 100% → packing
- packProgress = 100% → packed

#### 3.2.2 状态历史记录

**需求描述**: 系统需要记录所有状态变更的历史信息，包括变更时间、操作人员、变更原因等。

**功能要求**:

- 记录每次状态变更的详细信息
- 支持状态历史查询
- 支持状态历史导出
- 提供状态变更统计

**历史记录字段**:

```json
{
n  "status": "新状态",
  "previousStatus": "原状态",
  "timestamp": "变更时间",
  "operator": "操作人员",
  "remark": "备注信息",
  "packProgress": "打包进度",
  "packedParts": "已打包部件数",
  "totalParts": "总部件数"
}
```

### 3.3 出货管理

#### 3.3.1 出货状态管理

**需求描述**: 系统需要支持客户出货状态的管理，包括全部出货、部分出货和未出货状态。

**功能要求**:

- 支持全部出货操作
- 支持部分出货操作
- 支持标记为未出货操作
- 提供出货状态选择对话框
- 记录出货时间和操作历史

**出货操作前提条件**:

- 客户状态必须为"已打包"或"正在处理"
- 出货操作需要用户确认
- 出货状态变更需要记录历史

#### 3.3.2 出货流程管理

**需求描述**: 系统需要提供完整的出货流程管理，包括出货申请、审批、执行和确认。

**功能要求**:

- 提供出货操作界面
- 支持出货备注功能
- 支持出货状态查询
- 提供出货统计报表

**状态转换规则**:

```
[未打包] -> [正在处理] -> [已打包] -> [已出货]
                              |-----> [部分出货]
                              |-----> [未出货]
                              |-----> [已归档] -> [已出货]
                                         |-----> [部分出货]
                                         |-----> [未出货]
```

### 3.4 补件管理

#### 3.4.1 补件状态管理

**需求描述**: 系统需要支持补件状态的管理，包括无补件、部分补件和全部补件状态。

**功能要求**:

- 支持补件状态标记
- 支持补件状态自动计算
- 提供补件状态查询
- 记录补件状态变更历史

**补件状态规则**:

- unshipped（未出货）→ none（无补件）
- partial（部分出货）→ partial（部分补件）
- shipped（全部出货）→ partial（部分补件）或 full（全部补件）

#### 3.4.2 补件处理流程

**需求描述**: 系统需要提供完整的补件处理流程，包括补件检测、XML 生成、补件出货等。

**功能要求**:

- 自动检测补件目录
- 解析补件 XML 文件
- 根据 UID 查询客户信息
- 根据出货状态处理补件
- 生成补件 XML 文件
- 记录补件处理日志

**补件处理规则**:

- 未出货状态：合并到原始 XML
- 已出货状态：生成新的补件 XML
- 补件 XML 必须包含完整客户信息
- 补件 XML 需要添加补件标识字段

### 3.5 归档管理

#### 3.5.1 归档操作

**需求描述**: 系统需要支持客户数据的归档操作，包括归档、恢复归档等。

**功能要求**:

- 支持客户数据归档
- 支持归档数据恢复
- 提供归档列表查询
- 支持归档数据导出

**归档操作前提条件**:

- 客户状态必须为"已打包"
- 归档操作需要用户确认
- 归档后客户状态变更为"已归档"

#### 3.5.2 归档数据管理

**需求描述**: 系统需要能够管理归档数据，包括查询、导出、恢复等操作。

**功能要求**:

- 提供归档数据列表
- 支持归档数据分页查询
- 支持归档数据详情查看
- 支持归档数据导出为 Excel/PDF
- 支持归档数据恢复

### 3.6 系统管理

#### 3.6.1 配置管理

**需求描述**: 系统需要提供配置管理功能，包括系统参数设置、路径配置等。

**功能要求**:

- 支持系统参数配置
- 支持文件路径配置
- 支持配置参数的导入导出
- 提供配置参数验证

**配置参数**:

```json
{
n  "sourcePath": "源文件路径",
  "localPath": "本地输出路径",
  "networkPath": "网络路径",
  "autoSave": "自动保存间隔",
  "logLevel": "日志级别"
}
```

#### 3.6.2 日志管理

**需求描述**: 系统需要提供完整的日志管理功能，包括日志记录、查询、导出等。

**功能要求**:

- 记录系统操作日志
- 记录错误日志
- 支持日志查询和筛选
- 支持日志导出
- 支持日志级别配置

#### 3.6.3 用户管理

**需求描述**: 系统需要提供用户管理功能，包括用户登录、权限控制等。

**功能要求**:

- 支持用户登录
- 支持用户权限管理
- 支持操作记录
- 提供用户会话管理

## 4. 技术需求

### 4.1 性能需求

#### 4.1.1 响应时间

- 客户列表加载时间 ≤ 3 秒
- 状态更新响应时间 ≤ 2 秒
- 文件监控响应时间 ≤ 1 秒
- 数据查询响应时间 ≤ 5 秒

#### 4.1.2 并发处理

- 支持多用户同时操作
- 支持并发文件监控
- 支持并发数据处理

#### 4.1.3 数据处理

- 支持大量客户数据处理（≥ 10000 条记录）
- 支持大文件处理（≥ 100MB）
- 支持批量数据处理

### 4.2 可靠性需求

#### 4.2.1 系统稳定性

- 系统连续运行时间 ≥ 7 天
- 系统崩溃恢复时间 ≤ 5 分钟
- 数据完整性保证 100%

#### 4.2.2 数据安全

- 数据备份机制
- 数据恢复机制
- 数据加密存储
- 操作日志记录

#### 4.2.3 错误处理

- 完善的错误捕获机制
- 友好的错误提示
- 错误日志记录
- 错误恢复机制

### 4.3 可用性需求

#### 4.3.1 用户界面

- 直观的操作界面
- 清晰的状态显示
- 友好的交互体验
- 响应式设计

#### 4.3.2 操作便捷性

- 简化的操作流程
- 快捷键支持
- 批量操作支持
- 操作撤销功能

#### 4.3.3 帮助支持

- 操作提示
- 帮助文档
- 错误说明
- 在线支持

### 4.4 兼容性需求

#### 4.4.1 操作系统

- Windows 10/11
- macOS 10.14+
- Linux Ubuntu 18.04+

#### 4.4.2 浏览器兼容

- Chrome 80+
- Firefox 75+
- Safari 13+
- Edge 80+

#### 4.4.3 数据格式

- XML 文件处理
- JSON 数据格式
- Excel 文件导入导出
- PDF 文件生成

## 5. 业务流程

### 5.1 客户数据管理流程

#### 5.1.1 客户数据导入流程

```
开始
  ↓
监控源文件目录
  ↓
检测新增/更新文件
  ↓
验证文件格式
  ↓
解析XML客户数据
  ↓
数据验证和清洗
  ↓
更新/插入数据库
  ↓
记录同步日志
  ↓
生成同步报告
  ↓
结束
```

#### 5.1.2 客户数据管理流程

```
开始
  ↓
源文件监控和检测
  ↓
客户信息自动解析
  ↓
客户信息验证和清洗
  ↓
客户信息存储和同步
  ↓
客户状态自动更新
  ↓
客户信息查询和展示
  ↓
结束
```

#### 5.1.3 客户状态更新流程

```
开始
  ↓
监控 packages.json 文件
  ↓
检测文件变化
  ↓
解析 partIDs 记录
  ↓
计算打包进度
  ↓
更新客户状态
  ↓
记录状态历史
  ↓
结束
```

### 5.2 出货管理流程

#### 5.2.1 出货操作流程

```
开始
  ↓
选择客户
  ↓
验证客户状态
  ↓
显示出货选择对话框
  ↓
选择出货类型（全部/部分）
  ↓
确认出货操作
  ↓
更新客户状态
  ↓
记录出货历史
  ↓
显示操作结果
  ↓
结束
```

#### 5.2.2 补件处理流程

```
开始
  ↓
检测补件目录
  ↓
解析补件 XML
  ↓
提取客户 UID
  ↓
查询客户信息
  ↓
检查出货状态
  ↓
生成补件 XML
  ↓
更新补件状态
  ↓
记录处理日志
  ↓
结束
```

### 5.3 归档管理流程

#### 5.3.1 归档操作流程

```
开始
  ↓
选择客户
  ↓
验证客户状态
  ↓
确认归档操作
  ↓
执行归档处理
  ↓
更新客户状态
  ↓
记录归档历史
  ↓
显示操作结果
  ↓
结束
```

## 6. 用户界面需求

### 6.1 主界面

#### 6.1.1 界面布局

- 顶部：系统标题和菜单栏
- 左侧：功能导航栏
- 中间：主要内容区域
- 底部：状态栏和系统信息

#### 6.1.2 功能区域

- 客户列表区域
- 状态显示区域
- 操作按钮区域
- 信息展示区域

### 6.2 客户列表界面

#### 6.2.1 列表显示

- 客户基本信息
- 客户状态图标
- 打包进度显示
- 操作按钮

#### 6.2.2 状态图标

- 📦 打包状态（灰色/蓝色/绿色/深灰）
- 🚚 出货状态（灰色/橙色/绿色）
- 🔧 补件状态（灰色/橙色/红色）

### 6.3 操作界面

#### 6.3.1 出货选择对话框

- 出货类型选择（全部出货/部分出货）
- 客户信息显示
- 确认/取消按钮

#### 6.3.2 状态详情界面

- 状态历史记录
- 打包进度详情
- 操作记录
- 相关信息

## 7. 数据管理需求

### 7.1 数据库设计

#### 7.1.1 客户表 (customers)

```sql
CREATE TABLE customers (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  contact TEXT,
  phone TEXT,
  address TEXT,
  status TEXT DEFAULT 'unpacked',
  pack_progress INTEGER DEFAULT 0,
  packed_count INTEGER DEFAULT 0,
  total_parts INTEGER DEFAULT 0,
  pack_seqs TEXT,
  shipment_date TEXT,
  replacement_status TEXT DEFAULT 'none',
  create_time TEXT DEFAULT CURRENT_TIMESTAMP,
  update_time TEXT DEFAULT CURRENT_TIMESTAMP
);
```

#### 7.1.2 状态历史表 (status_history)

```sql
CREATE TABLE status_history (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  customer_id INTEGER,
  status TEXT NOT NULL,
  previous_status TEXT,
  timestamp TEXT DEFAULT CURRENT_TIMESTAMP,
  operator TEXT,
  remark TEXT,
  pack_progress INTEGER,
  packed_parts INTEGER,
  total_parts INTEGER,
  FOREIGN KEY (customer_id) REFERENCES customers(id)
);
```

#### 7.1.3 配置表 (configuration)

```sql
CREATE TABLE configuration (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  key TEXT UNIQUE NOT NULL,
  value TEXT NOT NULL,
  description TEXT,
  update_time TEXT DEFAULT CURRENT_TIMESTAMP
);
```

### 7.2 文件管理

#### 7.2.1 文件结构

```
pack-node-1.0/
├── src/
│   ├── main/          # 主进程代码
│   ├── ui/            # UI 相关代码
│   ├── api/           # API 接口
│   ├── utils/         # 工具函数
│   ├── database/      # 数据库相关
│   └── services/      # 业务服务
├── docs/              # 文档
├── data/              # 数据文件
├── logs/              # 日志文件
└── config/            # 配置文件
```

#### 7.2.2 数据文件

- packages.json：打包数据文件
- 客户 XML 文件：客户数据文件
- 补件 XML 文件：补件数据文件
- 配置文件：系统配置

### 7.3 数据备份

#### 7.3.1 备份策略

- 自动备份：每日定时备份
- 手动备份：用户手动触发备份
- 增量备份：只备份变化的数据

#### 7.3.2 备份内容

- 数据库文件
- 配置文件
- 日志文件
- 重要数据文件

## 8. 安全需求

### 8.1 数据安全

#### 8.1.1 数据加密

- 敏感数据加密存储
- 数据传输加密
- 配置文件加密

#### 8.1.2 访问控制

- 用户身份验证
- 权限控制
- 操作审计

### 8.2 系统安全

#### 8.2.1 输入验证

- 用户输入验证
- 文件上传验证
- API 参数验证

#### 8.2.2 错误处理

- 异常捕获
- 错误日志记录
- 安全错误信息

### 8.3 操作安全

#### 8.3.1 操作验证

- 重要操作确认
- 操作权限检查
- 操作日志记录

#### 8.3.2 数据完整性

- 数据校验
- 事务处理
- 并发控制

## 9. 测试需求

### 9.1 功能测试

#### 9.1.1 测试范围

- 客户数据管理功能
- 状态管理功能
- 出货管理功能
- 补件管理功能
- 归档管理功能
- 系统管理功能

#### 9.1.2 测试用例

- 正常流程测试
- 异常流程测试
- 边界条件测试
- 性能测试

### 9.2 性能测试

#### 9.2.1 测试指标

- 响应时间
- 并发处理能力
- 数据处理能力
- 系统稳定性

#### 9.2.2 测试环境

- 测试服务器配置
- 测试数据准备
- 测试工具选择

### 9.3 用户验收测试

#### 9.3.1 测试目标

- 验证业务需求
- 验证用户界面
- 验证操作流程
- 验证数据准确性

#### 9.3.2 测试人员

- 业务分析师
- 最终用户
- 测试工程师

## 10. 部署需求

### 10.1 环境要求

#### 10.1.1 服务器环境

- 操作系统：Windows 10/11 或 Linux
- 内存：≥ 4GB
- 硬盘：≥ 10GB
- 网络：稳定的网络连接

#### 10.1.2 客户端环境

- 操作系统：Windows 10/11, macOS 10.14+
- 内存：≥ 2GB
- 硬盘：≥ 1GB
- 显示器：分辨率 ≥ 1366×768

### 10.2 安装部署

#### 10.2.1 安装步骤

1. 解压安装包
2. 运行安装程序
3. 配置系统参数
4. 初始化数据库
5. 启动系统服务

#### 10.2.2 配置要求

- 数据库连接配置
- 文件路径配置
- 系统参数配置
- 用户权限配置

### 10.3 维护要求

#### 10.3.1 日常维护

- 系统监控
- 日志检查
- 数据备份
- 性能优化

#### 10.3.2 故障处理

- 故障诊断
- 故障恢复
- 问题跟踪
- 经验总结

## 11. 项目计划

### 11.1 开发阶段

#### 11.1.1 需求分析阶段

- 时间：1 周
- 任务：需求收集、分析、文档编写
- 交付物：需求文档、功能规格说明书

#### 11.1.2 设计阶段

- 时间：2 周
- 任务：系统设计、数据库设计、界面设计
- 交付物：设计文档、数据库设计文档、界面原型

#### 11.1.3 开发阶段

- 时间：4 周
- 任务：功能开发、单元测试、集成测试
- 交付物：可运行的系统、测试报告

#### 11.1.4 测试阶段

- 时间：2 周
- 任务：系统测试、用户验收测试、性能测试
- 交付物：测试报告、问题清单

#### 11.1.5 部署阶段

- 时间：1 周
- 任务：系统部署、用户培训、文档交付
- 交付物：部署文档、用户手册、培训材料

### 11.2 里程碑

#### 11.2.1 关键节点

- 需求确认完成
- 系统设计完成
- 核心功能开发完成
- 系统测试完成
- 系统部署完成

#### 11.2.2 验收标准

- 功能完整性：100% 需求实现
- 性能指标：满足所有性能需求
- 质量标准：通过所有测试用例
- 用户满意度：用户验收通过

## 12. 风险管理

### 12.1 技术风险

#### 12.1.1 风险识别

- 技术选型风险
- 性能风险
- 兼容性风险
- 安全风险

#### 12.1.2 风险应对

- 技术调研和验证
- 性能测试和优化
- 兼容性测试
- 安全审计和加固

### 12.2 项目风险

#### 12.2.1 风险识别

- 需求变更风险
- 进度延期风险
- 资源不足风险
- 质量风险

#### 12.2.2 风险应对

- 需求变更控制
- 进度监控和调整
- 资源规划和调配
- 质量保证措施

### 12.3 业务风险

#### 12.3.1 风险识别

- 业务理解偏差
- 用户接受度风险
- 数据迁移风险
- 培训风险

#### 12.3.2 风险应对

- 充分的需求沟通
- 用户参与和反馈
- 数据迁移方案
- 完善的培训计划

## 13. 附录

### 13.1 术语表

#### 13.1.1 技术术语

- **Electron**: 用于构建跨平台桌面应用的框架
- **Node.js**: JavaScript 运行时环境
- **Express**: Node.js 的 Web 应用框架
- **SQLite**: 轻量级关系型数据库
- **IPC**: 进程间通信（Inter-Process Communication）

#### 13.1.2 业务术语

- **打包状态**: 客户数据在打包过程中的状态
- **出货状态**: 客户货物的出货状态
- **补件状态**: 客户补件的处理状态
- **归档状态**: 客户数据的归档状态
- **partIDs**: 打包数据中的部件标识符

### 13.2 参考文档

#### 13.2.1 技术文档

- Electron 官方文档
- Node.js 官方文档
- Express 官方文档
- SQLite 官方文档

#### 13.2.2 业务文档

- 客户状态管理功能说明
- 出货功能模块设计文档
- 补件设计文档
- API 接口文档

### 13.3 联系信息

#### 13.3.1 项目团队

- 项目经理：[联系人]
- 技术负责人：[联系人]
- 业务分析师：[联系人]
- 测试负责人：[联系人]

#### 13.3.2 技术支持

- 开发团队：[联系方式]
- 运维团队：[联系方式]
- 用户支持：[联系方式]

---

**文档版本**: 1.0
**创建日期**: 2024-01-01
**最后更新**: 2024-01-01
**文档状态**: 初稿
